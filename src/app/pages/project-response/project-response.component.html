

<div class="container mt-4" *ngIf="project; else loadingOrError">
  <h2>{{ project.name }}</h2>
  <p>{{ project.description }}</p>
  <hr />

  <form [formGroup]="responseForm" (ngSubmit)="onSubmit()">
    <div
      *ngFor="let q of questions; let i = index"
      class="mb-4 border rounded p-3"
    >
      <label class="form-label"><strong>{{ q.text }}</strong></label>

      <!-- Freitext / Textfeld -->
      <div *ngIf="q.type === 'text'">
        <input type="text" class="form-control" [formControl]="getAnswerControl(i)"/>
      </div>
      <!-- Textarea -->
      <div *ngIf="q.type === 'textarea'">
        <textarea class="form-control" rows="5" [formControl]="getAnswerControl(i)"></textarea>
      </div>

      <!-- Datum -->
      <div *ngIf="q.type === 'date'">
        <input type="date" class="form-control" [formControl]="getAnswerControl(i)"/>
      </div>

      <!-- Radio-Buttons -->
      <div *ngIf="q.type === 'radio'">
        <div *ngFor="let opt of q.options; let pi = index" class="form-check">
          <input class="form-check-input" type="radio" [value]="opt.value" [formControl]="getAnswerControl(i)"
            [id]="'radio_' + q.id + '_' + pi"/>
          <label class="form-check-label" [for]="'radio_' + q.id + '_' + pi">
            {{ opt.label }}
          </label>
        </div>
      </div>

      <!-- Checkboxen -->
      <div *ngIf="q.type === 'checkbox'">
        <div *ngFor="let opt of q.options; let pi = index" class="form-check">
          <input class="form-check-input" type="checkbox" 
          [formControl]="getCheckboxControl(i, pi)" [id]="'cb_' + q.id + '_' + pi"/>
          <label class="form-check-label" [for]="'cb_' + q.id + '_' + pi">{{ opt.label }}
          </label>
        </div>
      </div>

      <!-- Select / Dropdown -->
      <div *ngIf="q.type === 'select'">
        <select class="form-select" [formControl]="getAnswerControl(i)">
          <option value="">– Bitte wählen –</option>
          <option *ngFor="let opt of q.options" [value]="opt.value">
            {{ opt.label }}
          </option>
        </select>
      </div>

      <!-- Fallback für nicht definierte Typen -->
      <div
        *ngIf="!['text', 'textarea', 'date', 'radio', 'checkbox', 'select'].includes(q.type)">
        <input type="text" class="form-control" [formControl]="getAnswerControl(i)"/>
      </div>
    </div>

    <button type="submit" class="btn btn-primary" [disabled]="responseForm.invalid">Antworten abschicken</button>
  </form>
</div>

<ng-template #loadingOrError>
  <div class="text-center mt-5">
    <p *ngIf="!project">Lade Projekt …</p>
    <p *ngIf="project === null">
      Projekt nicht gefunden oder Fehler aufgetreten.
    </p>
  </div>
</ng-template>
